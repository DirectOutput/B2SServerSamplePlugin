<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>B2S.Server Sample Plugin: Implement your own plugin using C#</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="directoutputstyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo" width="100px"><img alt="Logo" src="B2SServerSamplePlugin_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">B2S.Server Sample Plugin
   </div>
   <div id="projectbrief">Sample plugin implementation for the B2S.Server</div>
  </td>
  <td align="right" valign="top">
  <a href="http://directoutput.github.com/B2SServerPluginInterface/">Switch to B2S.Server Plugin Interface Documentation</a>&nbsp;
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('implementcsharp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Implement your own plugin using C# </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="implementcsharp_introduction"></a>
Introduction</h1>
<p>Creating your own plugin is a relatively easy process. You only neeed to build a new class library, implement the IDirectPlugin interface(s) and decorate the class with [Export(typeof(IDirectPlugin))] to get rolling.</p>
<p>The following sections are explaing plugin creation in more detail.</p>
<h1><a class="anchor" id="implementcsharp_prerequisites"></a>
Prerequisites</h1>
<ul>
<li>To create a plugin you need some development environement for C#. The best IDE for C# is Microsofts Visual Studio. The Express Version of Visual Studio is available for free from Microsofts website.</li>
<li>Since plugins have to implement specific interfaces, yull have to aquire a copy of the B2SServerPluginInterface.dll. This dll is part of the B2S.Server deployment package and can also be downloaded separately from the project page on the B2S.Server Plugin Interface.</li>
<li>To run your plugin you will need the B2S.Server as well as Visual Pinball and a Visual Pinball Table clling the B2S.Server.</li>
</ul>
<h1><a class="anchor" id="implementcsharp_implement"></a>
Implementation Step by Step</h1>
<p>This step by step guide will teach you how to implement your own plugin.</p>
<p>Sorry, all screenshots are from a german version of Visual Studio.</p>
<h2><a class="anchor" id="implementcsharp_step1"></a>
Step 1: Create the project</h2>
<p>Start Visual Studio and create a new class library project. Dont forget to give a nice name to your plugin.</p>
<div class="image">
<img src="ImplementCSharp001.jpg" alt="ImplementCSharp001.jpg"/>
<div class="caption">
Creating a new project</div></div>
 <h2><a class="anchor" id="implementcsharp_step2"></a>
Step 2: Add References</h2>
<p>Add references to B2SServerPluginInterface and System.ComponentModel.Composition.</p>
<div class="image">
<img src="ImplementCSharp002.jpg" alt="ImplementCSharp002.jpg"/>
</div>
<p>Browse for the B2SServerPluginInterface.dll and click OK.</p>
<div class="image">
<img src="ImplementCSharp003.jpg" alt="ImplementCSharp003.jpg"/>
<div class="caption">
Adding a reference the B2SServerPluginInterface.dll</div></div>
<p> Add another reference to System.ComponentModel.Composition by selection the .NET tab in the dialog and selecting the mentioned component.</p>
<div class="image">
<img src="ImplementCSharp004.jpg" alt="ImplementCSharp004.jpg"/>
<div class="caption">
Adding a reference to the System.ComponentModel.Composition component</div></div>
 <h2><a class="anchor" id="implementcsharp_step3"></a>
Step 3: Rename the class</h2>
<p>Now it would be a good idea to rename the class (class1.cs) which was during project creation to something meaningfull. If the system asks you to rename all references to the old class name, click yes.</p>
<div class="image">
<img src="ImplementCSharp005.jpg" alt="ImplementCSharp005.jpg"/>
<div class="caption">
Rename the class</div></div>
 <h2><a class="anchor" id="implementcsharp_step4"></a>
Step 4: Add using statements</h2>
<p>Add using statements for B2SServerPluginInterface and e System.ComponentModel.Composition namespaces to your class.</p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line"><span class="keyword">using</span> System.ComponentModel.Composition;</div>
<div class="line"><span class="keyword">using</span> B2SServerPluginInterface;</div>
</div><!-- fragment --><h2><a class="anchor" id="implementcsharp_step5"></a>
Step 5: Export the class</h2>
<p>Add the Export attribute to the top of your class, to allow the export of the class for the use by the MEF framework (that is whats inside the System.ComponentModel.Composition namespace). </p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line">[Export(typeof(IDirectPlugin))]</div>
</div><!-- fragment --><p>Your plugin class should now look like this:</p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line"><span class="keyword">using</span> System;</div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> System.ComponentModel.Composition;</div>
<div class="line"><span class="keyword">using</span> B2SServerPluginInterface;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>MyOwnPlugin</div>
<div class="line">{</div>
<div class="line">    [Export(typeof(IDirectPlugin))]</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>MyPlugin </div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="implementcsharp_step6"></a>
Step 6: Implement IDirectPlugin interface(s)</h2>
<p>Next you have to implement the necessary interfaces. It is mandatory to implement IDirectPlugin, the other interfaces in the B2SServerPluginInterface namespace are optional.</p>
<p>First tell your plugin class to inherit the IDirectPlugin interface.</p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class</span> MyPlugin : IDirectPlugin</div>
</div><!-- fragment --><p>If you plan to have a configuration frontend for your plugin or to get updates on important PinMame events, inherit IDirectPluginFrontEnd and/or IDirectPluginPinmame.</p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class</span> MyPlugin : IDirectPlugin, IDirectPluginFrontend, IDirectPluginPinMame</div>
</div><!-- fragment --><p>Now you have to implement the methods of the inherited plugins. The easiest way to get a rough structure for the plugin member implementation is to click the name of a interface in the class definition with the right mouse button and select "Implement interface" (depending on your version of Visual Studio this function might not be available).</p>
<div class="image">
<img src="ImplementCSharp006.jpg" alt="ImplementCSharp006.jpg"/>
<div class="caption">
Implement a interface</div></div>
<p> This will result in the following code for the IDirectPlugin interface;</p>
<div class="fragment"><div class="line">{(.cs)}</div>
<div class="line"><span class="keyword">using</span> System;</div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> System.ComponentModel.Composition;</div>
<div class="line"><span class="keyword">using</span> B2SServerPluginInterface;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>MyOwnPlugin</div>
<div class="line">{</div>
<div class="line">    [Export(typeof(IDirectPlugin))]</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>MyPlugin : IDirectPlugin, IDirectPluginFrontend, IDirectPluginPinMame</div>
<div class="line">    {</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        #region IDirectPlugin Members</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> DataReceive(<span class="keywordtype">char</span> TableElementTypeChar, <span class="keywordtype">int</span> Number, <span class="keywordtype">int</span> Value)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> Name</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">get</span> { <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException(); }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> PluginFinish()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> PluginInit(<span class="keywordtype">string</span> TableFilename, <span class="keywordtype">string</span> RomName = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        #endregion</span></div>
<div class="line"><span class="preprocessor"></span>    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Get a implementation for the other interfaces the same way.</p>
<p>Alternatively you can also implement the interface member by hand.</p>
<h2><a class="anchor" id="implementcsharp_step7"></a>
Step 7: Be creative!</h2>
<p>Now it is your turn to be creative and add some functionality to your plugin.</p>
<p>Remove the throw new NotImplementedException(); statements from the default plugin implementation and add your own code.</p>
<p>See the guidelines section for some general hints how to implement your own fuctionality.</p>
<h2><a class="anchor" id="implementcsharp_step8"></a>
Step 8: Build and Install</h2>
<p>Once you have completed the code for your plugin build the code in Visual Studio. This will result in a dll file having the same name as your plugin project.</p>
<p>Copy this dll to a appropriatley named sub folder of the plugin directory of your B2S.Server installation. If your B2S.Server is located in the Tables directory of Visual Pinball your directory structre might looks as follows:</p>
<div class="image">
<img src="ImplementCSharp007.jpg" alt="ImplementCSharp007.jpg"/>
<div class="caption">
Directory structure</div></div>
<p> Alternatively you can also put your plugin into any other directory on your system and add a windows shortcut pointing to this directory to the plugin directory of your B2S.Server installation.</p>
<h2><a class="anchor" id="implementcsharp_step9"></a>
Step 9: Test the Plugin</h2>
<p>After you have installed your plugin as advised above, it is time for some action.</p>
<p>Start Visual Pinball, load a table which is using the B2S.Server and start the table.</p>
<p>If everything is correct in your plugin implementation, the B2S.Server will load and execute your plugin automatically when the table is started.</p>
<p>Open the config window of the B2S.Server (click the backglass and push s on your keyboard) and click the plugin window button to open up a window showing all loaded plugins. If your plugin implements a frontend you can double click the name of the plugin in the B2S.Server plugin window to open up the frontend of the plugin. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jun 15 2013 13:40:26 for B2S.Server Sample Plugin by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-39987816-3', 'github.io');
  ga('send', 'pageview');
</script>
</body>
</html>
